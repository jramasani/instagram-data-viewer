<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Privately analyze your Instagram connections data - everything stays in your browser">
    <title>Instagram Data Viewer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>🔒</text></svg>">
    <!-- Include JSZip library for handling zip files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- Include D3.js for network visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="mock-data.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background: #fafafa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #262626;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 5px;
        }

        @media (min-width: 1400px) {
            .stats {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        .stat-card {
            background: var(--bg-primary);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 10px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 15px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-trend {
            font-size: 12px;
            margin-top: 8px;
            color: #00aa00;
        }

        .stat-trend.negative {
            color: #ff0000;
        }

        .section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .section {
                padding: 20px;
            }
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            gap: 15px;
        }

        .section-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .section-header h2 {
            margin: 0;
            font-size: 18px;
            flex: 1;
        }

        .section-info {
            margin-bottom: 15px;
            color: #8e8e8e;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .section-info i {
            font-size: 16px;
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #efefef;
            border-radius: 4px;
        }

        .user-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #efefef;
            transition: all 0.2s ease;
            justify-content: space-between;
            gap: 10px;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .user-link {
            color: #262626;
            text-decoration: none;
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-link i {
            font-size: 12px;
            color: #8e8e8e;
        }

        .timestamp {
            color: #8e8e8e;
            font-size: 12px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        @media (max-width: 480px) {
            .user-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .timestamp {
                width: 100%;
                justify-content: flex-start;
                padding-left: 24px;
            }
        }

        .search {
            width: 100%;
            padding: 10px 16px;
            border: 1px solid #dbdbdb;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .search:focus {
            outline: none;
            border-color: #0095f6;
        }

        .upload-section {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #dbdbdb;
            border-radius: 8px;
            background: white;
        }

        @media (min-width: 768px) {
            .upload-section {
                margin: 40px 0;
                padding: 40px;
            }
        }

        .upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .upload-icon {
            font-size: 48px;
            color: #8e8e8e;
        }

        .upload-title {
            font-size: 20px;
            font-weight: 600;
            color: #262626;
        }

        .upload-button {
            background: #0095f6;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .upload-button:hover {
            background: #0081d6;
        }

        .upload-info {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
            padding: 0 10px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #8e8e8e;
            font-size: 13px;
            text-align: left;
        }

        .info-item i {
            font-size: 18px;
        }

        .upload-section.drag-over {
            background: #f8f8f8;
            border-color: #0095f6;
        }

        .upload-text {
            color: #8e8e8e;
            margin: 10px 0;
        }

        #mainContent {
            display: none;
        }

        .documentation {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .documentation code {
            background: #f6f6f6;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .privacy-notice {
            color: #8e8e8e;
            font-size: 14px;
            text-align: center;
            margin: 20px 0;
        }

        .privacy-link {
            color: #00376b;
            text-decoration: none;
        }

        .privacy-link:hover {
            text-decoration: underline;
        }

        .support-button {
            display: inline-flex;
            align-items: center;
            background: #FFDD00;
            color: #000000;
            padding: 8px 16px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .support-button:hover {
            background: #FFE838;
            transform: translateY(-2px);
        }

        .support-button img {
            height: 20px;
            margin-right: 8px;
        }

        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            border-top: 1px solid #dbdbdb;
        }

        /* Privacy page specific styles */
        .privacy-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.8;
        }

        .privacy-content h2 {
            color: #262626;
            margin-top: 30px;
        }

        .privacy-content p {
            margin-bottom: 20px;
        }

        /* Platform tabs styling */
        .platform-tabs {
            display: flex;
            gap: 2px;
            margin-bottom: 20px;
            background: #f0f0f0;
            padding: 4px;
            border-radius: 8px;
        }

        .platform-tab {
            padding: 8px 16px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 500;
            color: #8e8e8e;
            flex: 1;
            transition: all 0.3s ease;
        }

        .platform-tab.active {
            background: white;
            color: #262626;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .platform-tab:hover:not(.active) {
            background: rgba(255,255,255,0.5);
        }

        .platform-content {
            display: none;
            margin-bottom: 20px;
        }

        .platform-content.active {
            display: block;
        }

        .reference-link {
            display: block;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dbdbdb;
            color: #8e8e8e;
            font-size: 14px;
            text-align: center;
        }

        .reference-link a {
            color: #00376b;
            text-decoration: none;
        }

        .reference-link a:hover {
            text-decoration: underline;
        }

        /* Comment out network visualization styles */
        /* Network visualization styles - for future release
        .network-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            overflow: hidden;
        }

        .network-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            max-width: 300px;
            z-index: 1001;
        }

        .network-info {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .network-info h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        #nodeDetails {
            font-size: 14px;
            color: #666;
        }

        .control-group {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .control-group h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .control-item {
            margin-bottom: 10px;
        }

        .control-item button {
            margin-right: 8px;
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }

        .control-item button:hover {
            background: #f5f5f5;
        }

        .network-legend {
            font-size: 14px;
        }

        .network-legend h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .legend-count {
            margin-left: auto;
            color: #666;
            font-size: 12px;
        }

        .node-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            pointer-events: none;
            z-index: 1002;
            max-width: 200px;
        }

        @media (max-width: 1200px) {
            .stats {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .sort-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            min-width: fit-content;
        }

        @media (max-width: 768px) {
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .sort-controls {
                width: 100%;
                overflow-x: auto;
                padding-bottom: 5px;
                -webkit-overflow-scrolling: touch;
                margin-left: 40px;
            }
        }
        
        @media (max-width: 480px) {
            .stats {
                grid-template-columns: 1fr;
            }
        }

        .sort-button {
            padding: 8px 12px;
            border: 1px solid #dbdbdb;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
            height: 32px;
        }

        .sort-button i {
            font-size: 14px;
        }

        .sort-button.active {
            background: #0095f6;
            color: white;
            border-color: #0095f6;
        }

        .date-info {
            font-size: 12px;
            color: #8e8e8e;
            margin-top: 5px;
        }

        .toggle-section {
            background: none;
            border: none;
            cursor: pointer;
            color: #8e8e8e;
            padding: 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
            height: 32px;
        }

        .toggle-section:hover {
            background: #f8f9fa;
            color: #262626;
        }

        .toggle-section i {
            transition: transform 0.3s ease;
        }

        .toggle-section.collapsed i {
            transform: rotate(-90deg);
        }

        .section-content {
            transition: all 0.3s ease-out;
            overflow: hidden;
            opacity: 1;
            margin-top: 15px;
        }

        .section-content.collapsed {
            display: none;
            opacity: 0;
            margin-top: 0;
        }

        .upload-section.error {
            border-color: #ffcdd2;
            background: #fff5f5;
        }

        .upload-section.error .upload-title {
            color: #e44;
        }

        .upload-section.error .upload-button {
            background: #e44;
            color: white;
        }

        .upload-section.error .upload-button:hover {
            background: #f55;
        }

        .intro-section {
            max-width: 800px;
            margin: 0 auto 40px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .intro-content {
            color: #262626;
            line-height: 1.6;
        }

        .intro-content h2 {
            color: #262626;
            margin: 25px 0 15px;
            font-size: 1.4em;
        }

        .intro-content ul {
            list-style: none;
            padding-left: 0;
        }

        .intro-content li {
            margin: 10px 0;
            padding-left: 25px;
            position: relative;
        }

        .intro-content li:before {
            position: absolute;
            left: 0;
        }

        .try-demo {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .demo-button {
            background: linear-gradient(135deg, #0095f6, #00bcd4);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,149,246,0.3);
        }

        .demo-note {
            color: #8e8e8e;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .demo-banner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #e8f5e9;
            padding: 10px;
            text-align: center;
            z-index: 1000;
        }

        .demo-notice {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .demo-notice button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        .waiting-banner {
            background: linear-gradient(135deg, #ffebee, #fff3e0);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 30px 0;
        }

        .waiting-icon {
            font-size: 32px;
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }

        .waiting-banner p {
            font-size: 16px;
            color: #262626;
            margin: 10px 0;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Updated color scheme */
        :root {
            --primary-gradient: linear-gradient(135deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
            --accent-color: #E1306C;
            --text-primary: #262626;
            --text-secondary: #8e8e8e;
            --bg-primary: #ffffff;
            --bg-secondary: #fafafa;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        /* Dark theme */
        @media (prefers-color-scheme: dark) {
            :root {
                --text-primary: #ffffff;
                --text-secondary: #b0b0b0;
                --bg-primary: #262626;
                --bg-secondary: #1a1a1a;
                --shadow: 0 4px 15px rgba(0,0,0,0.3);
            }
            
            body {
                background: var(--bg-secondary);
                color: var(--text-primary);
            }
            
            .stat-card {
                background: var(--bg-primary);
                color: var(--text-primary);
            }
            
            .section {
                background: var(--bg-primary);
            }
            
            .user-item:hover {
                background: rgba(255,255,255,0.05);
            }
        }

        /* Add styles for user avatars */
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 12px;
            object-fit: cover;
            background-color: #f0f0f0;
        }

        .user-avatar-placeholder {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 12px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }

        .user-name {
            flex-grow: 1;
        }
        */
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Instagram Data Viewer</h1>
        </div>

        <div class="intro-section">
            <h1>Instagram Data Viewer 🔒</h1>
            
            <div class="intro-content">
                <div class="what-you-get">
                    <h2>What is this tool?</h2>
                    <p>
                        A privacy-focused web tool that helps you analyze your Instagram connections. Perfect for:
                    </p>
                    <ul>
                        <li>🔍 Content Creators tracking follower growth</li>
                        <li>📊 Social Media Managers analyzing engagement</li>
                        <li>🧐 Users wanting to identify ghost followers</li>
                        <li>🚫 Anyone managing blocked/restricted accounts</li>
                        <li>🕸️ Visual learners who prefer network graphs</li>
                    </ul>

                    <h2>Why use this tool?</h2>
                    <ul>
                        <li>✨ <strong>100% Private:</strong> All analysis happens in your browser - no data uploads</li>
                        <li>🎯 <strong>Focused Analysis:</strong> See exactly who follows you and who you follow</li>
                        <li>📱 <strong>Works Everywhere:</strong> Use on desktop or mobile</li>
                        <li>🔄 <strong>Always Current:</strong> Use your latest Instagram data export</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="documentation">
            <h2>How to Get Your Instagram Followers & Following Data</h2>
            <p style="color: #8e8e8e; margin-bottom: 20px;">
                You only need your followers and following data. Choose your Instagram setup below:
            </p>

            <div class="platform-tabs">
                <button class="platform-tab active" onclick="showPlatform('meta')">Meta Accounts Center</button>
                <button class="platform-tab" onclick="showPlatform('instagram')">Instagram Settings</button>
                <button class="platform-tab" onclick="showPlatform('lite')">Instagram Lite</button>
            </div>

            <div id="meta-instructions" class="platform-content active">
                <p><strong>For accounts connected to Meta Accounts Center:</strong></p>
                <ol>
                    <li><strong>Go to Meta Accounts Center</strong>
                        <ul>
                            <li>Open Instagram Settings</li>
                            <li>Tap/Click "Accounts Center"</li>
                        </ul>
                    </li>
                    <li><strong>Navigate to Download Options</strong>
                        <ul>
                            <li>Select "Your information and permissions"</li>
                            <li>Click "Download your information"</li>
                            <li>Click "Download or transfer information"</li>
                        </ul>
                    </li>
                    <li><strong>Select Data to Download</strong>
                        <ul>
                            <li>Choose "Some of your information" (not "All your information")</li>
                            <li>Under "Connections" section, check only "Followers and following"</li>
                            <li>Uncheck all other options (we only need followers/following data)</li>
                        </ul>
                    </li>
                    <li><strong>Configure Download Settings</strong>
                        <ul>
                            <li>Click "Download to device"</li>
                            <li>Select your preferred date range</li>
                            <li>Change format to "JSON" (important!)</li>
                            <li>Click "Submit request"</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div id="instagram-instructions" class="platform-content">
                <p><strong>For regular Instagram accounts (not connected to Meta):</strong></p>
                <ol>
                    <li>Go to Instagram Settings (gear icon ⚙️ or three lines ☰)</li>
                    <li>Select "Privacy and Security"</li>
                    <li>Scroll to "Data Download" section</li>
                    <li>Click "Request Download"</li>
                    <li>Enter your email address</li>
                    <li>Select "JSON" as the format (required)</li>
                    <li>Enter your Instagram password</li>
                    <li>Click "Next" and then "Done"</li>
                </ol>
            </div>

            <div id="lite-instructions" class="platform-content">
                <p><strong>For Instagram Lite users:</strong></p>
                <ol>
                    <li>Tap the profile icon (👤)</li>
                    <li>Tap the menu (☰) in the top right</li>
                    <li>Tap "Settings"</li>
                    <li>Tap "Account"</li>
                    <li>Tap "Download your information"</li>
                    <li>Enter your email</li>
                    <li>Select "JSON" format (required)</li>
                    <li>Tap "Request download"</li>
                </ol>
            </div>

            <div class="waiting-banner">
                <div class="waiting-icon">⏳</div>
                <p>Instagram takes up to 48 hours to prepare your data. While you wait...</p>
                <button onclick="loadDemoData()" class="demo-button">
                    Try Demo Version
                </button>
            </div>
        </div>

        <div class="privacy-notice">
            🔒 Your privacy matters! We process all data locally in your browser - nothing is uploaded to any server. 
            <a href="privacy.html" class="privacy-link">Learn more about our privacy policy</a>
        </div>

        <div class="upload-section" id="uploadSection">
            <div class="upload-container">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-title">Upload Your Instagram Data</div>
                <input type="file" id="zipUpload" accept=".zip" style="display: none">
                <button class="upload-button" onclick="document.getElementById('zipUpload').click()">
                    <i class="fas fa-file-archive"></i> Select ZIP File
                </button>
                <p class="upload-text">or drag and drop your ZIP file here</p>
                
                <div class="upload-info">
                    <div class="info-item">
                        <i class="fas fa-lock"></i>
                        <span>100% Private</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-desktop"></i>
                        <span>Processed Locally</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-bolt"></i>
                        <span>Instant Results</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="mainContent">
            <div class="stats">
                <div class="stat-card" onclick="scrollToSection('followersList')">
                    <div class="stat-number" id="followersCount">0</div>
                    <div class="stat-label">Followers</div>
                    <div class="stat-trend" id="followersGrowth"></div>
                </div>
                <div class="stat-card" onclick="scrollToSection('followingList')">
                    <div class="stat-number" id="followingCount">0</div>
                    <div class="stat-label">Following</div>
                    <div class="stat-trend" id="followingRatio"></div>
                </div>
                <div class="stat-card" onclick="scrollToSection('blockedList')">
                    <div class="stat-number" id="blockedCount">0</div>
                    <div class="stat-label">Blocked</div>
                    <div class="stat-trend">For your peace of mind</div>
                </div>
                <div class="stat-card" onclick="scrollToSection('notFollowingBackSection')">
                    <div class="stat-number" id="notFollowingBackCount">0</div>
                    <div class="stat-label" id="notFollowingBackLabel">Not Following You Back</div>
                    <div class="stat-trend negative">People you follow who don't follow you</div>
                </div>
                <div class="stat-card" onclick="scrollToSection('youDontFollowSection')">
                    <div class="stat-number" id="youDontFollowCount">0</div>
                    <div class="stat-label" id="youDontFollowLabel">You Don't Follow Back</div>
                    <div class="stat-trend">People who follow you but you don't follow</div>
                </div>
                <div class="stat-card" onclick="scrollToSection('restrictedSection')">
                    <div class="stat-number" id="restrictedCount">0</div>
                    <div class="stat-label">Restricted</div>
                </div>
                <!-- Commenting out network graph feature for future release
                <div class="stat-card" onclick="showNetworkView()">
                    <div class="stat-number">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <div class="stat-label">Interactive Network</div>
                    <div class="stat-trend">Visualize connections</div>
                </div>
                -->
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" 
                                onclick="toggleSection(this)" 
                                aria-expanded="true" 
                                aria-label="Toggle section">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>Followers</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('followersList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('followersList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('followersList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> When they followed you</span>
                    </div>
                    <input type="text" class="search" id="followersSearch" placeholder="Search followers...">
                    <div class="user-list" id="followersList"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" 
                                onclick="toggleSection(this)" 
                                aria-expanded="true" 
                                aria-label="Toggle section">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>Following</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('followingList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('followingList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('followingList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> When you followed them</span>
                    </div>
                    <input type="text" class="search" id="followingSearch" placeholder="Search following...">
                    <div class="user-list" id="followingList"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" 
                                onclick="toggleSection(this)" 
                                aria-expanded="true" 
                                aria-label="Toggle section">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>Blocked Users</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('blockedList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('blockedList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('blockedList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> When you blocked these users</span>
                    </div>
                    <input type="text" class="search" id="blockedSearch" placeholder="Search blocked users...">
                    <div class="user-list" id="blockedList"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" 
                                onclick="toggleSection(this)" 
                                aria-expanded="true" 
                                aria-label="Toggle section">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>Restricted Users</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('restrictedList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('restrictedList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('restrictedList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> When you restricted these users</span>
                    </div>
                    <input type="text" class="search" id="restrictedSearch" placeholder="Search restricted users...">
                    <div class="user-list" id="restrictedList"></div>
                </div>
            </div>

            <div class="section" id="notFollowingBackSection">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" 
                                onclick="toggleSection(this)" 
                                aria-expanded="true" 
                                aria-label="Toggle section">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>People Who Don't Follow You Back</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('notFollowingBackList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('notFollowingBackList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('notFollowingBackList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> People you follow who don't follow you back</span>
                    </div>
                    <div class="user-list" id="notFollowingBackList"></div>
                </div>
            </div>

            <div class="section" id="youDontFollowSection">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" 
                                onclick="toggleSection(this)" 
                                aria-expanded="true" 
                                aria-label="Toggle section">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>People Who Follow You But You Don't Follow Back</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('youDontFollowList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('youDontFollowList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('youDontFollowList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> People who follow you but you don't follow back</span>
                    </div>
                    <div class="user-list" id="youDontFollowList"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Find this tool useful?</p>
            <a href="https://www.buymeacoffee.com/jramasani" target="_blank" class="support-button">
                <img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="Buy me a coffee">
                Buy me a coffee
            </a>
        </div>
    </div>

    <!-- Comment out network view for future release
    <div id="networkView" class="network-view">
        <button class="close-network" onclick="hideNetworkView()">×</button>
        <div class="network-controls">
            <div class="network-info">
                <h3>Selected Node: <span id="selectedNode">None</span></h3>
                <div id="nodeDetails"></div>
            </div>
            <div class="control-group">
                <h4>Controls</h4>
                <div class="control-item">
                    <button id="resetLayout" onclick="resetNetworkLayout()">Reset Layout</button>
                    <button id="centerGraph" onclick="centerNetworkGraph()">Center Graph</button>
                </div>
            </div>
            <div class="network-legend">
                <h4>Network Legend</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background: #1da1f2"></div>
                    <span>You (Center)</span>
                    <span class="legend-count" id="centerCount">1</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4caf50"></div>
                    <span>Mutual Connections</span>
                    <span class="legend-count" id="mutualCount">0</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #5851DB"></div>
                    <span>You Follow Them</span>
                    <span class="legend-count" id="followingCount">0</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #833AB4"></div>
                    <span>They Follow You</span>
                    <span class="legend-count" id="followerCount">0</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #C13584"></div>
                    <span>Blocked Users</span>
                    <span class="legend-count" id="blockedCount">0</span>
                </div>
            </div>
        </div>
    </div>
    -->

    <script>
        // Add this at the very beginning of your script section
        const DEBUG = false;  // Set to true to enable logging
        const log = {
            info: (...args) => DEBUG && console.log(...args),
            error: (...args) => DEBUG && console.error(...args),
            warn: (...args) => DEBUG && console.warn(...args)
        };

        // Platform tabs functionality
        function showPlatform(platform) {
            // Update tabs
            document.querySelectorAll('.platform-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.platform-tab[onclick="showPlatform('${platform}')"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.platform-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${platform}-instructions`).classList.add('active');
        }

        // Handle file upload via drag and drop
        const uploadSection = document.getElementById('uploadSection');
        const mainContent = document.getElementById('mainContent');

        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('drag-over');
        });

        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('drag-over');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file.name.endsWith('.zip')) {
                handleFileUpload(e);
            } else {
                alert('Please upload a ZIP file');
            }
        });

        document.getElementById('zipUpload').addEventListener('change', (e) => {
            handleFileUpload(e);
        });

        // Main function to handle file upload
        function handleFileUpload(event) {
            const file = event.target.files?.[0] || event.dataTransfer?.files?.[0];
            if (!file) return;

            // Show loading state
            document.querySelector('.upload-title').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            document.querySelector('.upload-text').textContent = 'Please wait while we analyze your data locally';

            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const zip = await JSZip.loadAsync(e.target.result);
                    const jsonFiles = {};
                    
                    // Extract all JSON files from the followers_and_following directory
                    const promises = [];
                    zip.forEach((relativePath, zipEntry) => {
                        if (relativePath.includes('followers_and_following/') && relativePath.endsWith('.json')) {
                            const fileName = relativePath.split('/').pop();
                            console.log(`Found file: ${fileName}`);
                            const promise = zipEntry.async('string').then(content => {
                                try {
                                    jsonFiles[fileName] = JSON.parse(content);
                                    console.log(`Successfully parsed: ${fileName}`);
                                } catch (parseError) {
                                    console.error(`Error parsing ${fileName}:`, parseError);
                                }
                            });
                            promises.push(promise);
                        }
                    });

                    await Promise.all(promises);
                    console.log('Extracted files:', Object.keys(jsonFiles));
                    
                    if (Object.keys(jsonFiles).length === 0) {
                        throw new Error('No Instagram data files found in the ZIP');
                    }
                    
                    // Process the data
                    processExtractedFiles(jsonFiles);

                } catch (error) {
                    console.error('Error processing ZIP file:', error);
                    showError(
                        "Error Processing File",
                        "Please make sure:",
                        [
                            "You're using the ZIP file from Instagram",
                            "The file downloaded completely",
                            "You selected JSON format when requesting data"
                        ]
                    );
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Process the extracted JSON files
        function processExtractedFiles(jsonFiles) {
            try {
                console.log('Processing extracted files:', jsonFiles);
                window.instagramData = jsonFiles; // Store for network visualization
                
                // Extract data from each file
                let followers = [];
                let following = [];
                let blocked = [];
                let restricted = [];
                
                // Debug all JSON files
                for (const fileName in jsonFiles) {
                    console.log(`File ${fileName} structure:`, JSON.stringify(jsonFiles[fileName]).substring(0, 200) + '...');
                }
                
                // Process followers (could be in followers_1.json or followers.json)
                if (jsonFiles['followers_1.json']) {
                    // Try different possible structures
                    if (jsonFiles['followers_1.json'].relationships_followers) {
                        followers = jsonFiles['followers_1.json'].relationships_followers;
                    } else if (Array.isArray(jsonFiles['followers_1.json'])) {
                        followers = jsonFiles['followers_1.json'];
                    } else {
                        // Try to find any array in the object
                        for (const key in jsonFiles['followers_1.json']) {
                            if (Array.isArray(jsonFiles['followers_1.json'][key])) {
                                followers = jsonFiles['followers_1.json'][key];
                                console.log(`Found followers array in key: ${key}`);
                                break;
                            }
                        }
                    }
                    console.log(`Found ${followers.length} followers in followers_1.json`);
                } else if (jsonFiles['followers.json']) {
                    // Similar logic for followers.json
                    if (jsonFiles['followers.json'].relationships_followers) {
                        followers = jsonFiles['followers.json'].relationships_followers;
                    } else if (Array.isArray(jsonFiles['followers.json'])) {
                        followers = jsonFiles['followers.json'];
                    } else {
                        for (const key in jsonFiles['followers.json']) {
                            if (Array.isArray(jsonFiles['followers.json'][key])) {
                                followers = jsonFiles['followers.json'][key];
                                console.log(`Found followers array in key: ${key}`);
                                break;
                            }
                        }
                    }
                    console.log(`Found ${followers.length} followers in followers.json`);
                }
                
                // Debug the followers data
                console.log('Followers data structure:', followers);
                if (followers.length > 0) {
                    console.log('First follower example:', JSON.stringify(followers[0]));
                }
                
                // Process following
                if (jsonFiles['following.json'] && jsonFiles['following.json'].relationships_following) {
                    following = jsonFiles['following.json'].relationships_following;
                } else if (jsonFiles['following.json']) {
                    // Try to find the array in the object
                    for (const key in jsonFiles['following.json']) {
                        if (Array.isArray(jsonFiles['following.json'][key])) {
                            following = jsonFiles['following.json'][key];
                            console.log(`Found following array in key: ${key}`);
                            break;
                        }
                    }
                }
                console.log(`Found ${following.length} following in following.json`);
                
                // Process blocked users
                if (jsonFiles['blocked_profiles.json'] && jsonFiles['blocked_profiles.json'].relationships_blocked_users) {
                    blocked = jsonFiles['blocked_profiles.json'].relationships_blocked_users;
                } else if (jsonFiles['blocked_profiles.json']) {
                    for (const key in jsonFiles['blocked_profiles.json']) {
                        if (Array.isArray(jsonFiles['blocked_profiles.json'][key])) {
                            blocked = jsonFiles['blocked_profiles.json'][key];
                            console.log(`Found blocked array in key: ${key}`);
                            break;
                        }
                    }
                }
                console.log(`Found ${blocked.length} blocked users in blocked_profiles.json`);
                
                // Process restricted users
                if (jsonFiles['restricted_profiles.json'] && jsonFiles['restricted_profiles.json'].relationships_restricted_users) {
                    restricted = jsonFiles['restricted_profiles.json'].relationships_restricted_users;
                } else if (jsonFiles['restricted_profiles.json']) {
                    for (const key in jsonFiles['restricted_profiles.json']) {
                        if (Array.isArray(jsonFiles['restricted_profiles.json'][key])) {
                            restricted = jsonFiles['restricted_profiles.json'][key];
                            console.log(`Found restricted array in key: ${key}`);
                            break;
                        }
                    }
                }
                console.log(`Found ${restricted.length} restricted users in restricted_profiles.json`);
                
                // Create a combined data object that matches our expected format
                const combinedData = {
                    followers: followers,
                    following: {
                        relationships_following: following
                    },
                    blocked: {
                        relationships_blocked_users: blocked
                    },
                    restricted: {
                        relationships_restricted_users: restricted
                    }
                };
                
                // Process the combined data
                processInstagramData(combinedData);
                
            } catch (error) {
                console.error('Error processing extracted files:', error);
                showError(
                    'Error Processing Data',
                    'There was a problem processing your Instagram data:',
                    [
                        'Make sure you selected JSON format when requesting data',
                        'Check if the ZIP file contains followers and following data',
                        'Try downloading your data again from Instagram'
                    ]
                );
            }
        }

        // Helper function to show user-friendly errors
        function showError(title, subtitle, bulletPoints) {
            const uploadSection = document.getElementById('uploadSection');
            const uploadTitle = document.querySelector('.upload-title');
            const uploadText = document.querySelector('.upload-text');
            
            uploadTitle.innerHTML = `<i class="fas fa-exclamation-circle" style="color: #e44"></i> ${title}`;
            
            let errorHtml = `
                <div style="color: #666; margin: 15px 0;">
                    ${subtitle}
                    <ul style="text-align: left; margin: 10px 0; padding-left: 20px;">
                        ${bulletPoints.map(point => `<li>${point}</li>`).join('')}
                    </ul>
                </div>
                <button class="upload-button" onclick="document.getElementById('zipUpload').click()">
                    <i class="fas fa-redo"></i> Try Another File
                </button>
            `;
            
            uploadText.innerHTML = errorHtml;
            uploadSection.classList.add('error');
        }

        // Process the Instagram data from JSON files
        function processInstagramData(data) {
            try {
                console.log('Processing data:', data);
                window.instagramData = data;
                
                // Process followers - direct array in followers_1.json
                const followers = data.followers || [];
                
                // Process following - nested in relationships_following
                const following = data.following?.relationships_following || [];
                
                // Process blocked users
                const blocked = data.blocked?.relationships_blocked_users || [];
                
                // Process restricted users
                const restricted = data.restricted?.relationships_restricted_users || [];
                
                // Normalize the data for consistent processing
                const normalizedFollowers = normalizeUserData(followers);
                const normalizedFollowing = normalizeUserData(following);
                const normalizedBlocked = normalizeUserData(blocked);
                const normalizedRestricted = normalizeUserData(restricted);
                
                // Calculate relationships
                const notFollowingBack = calculateNotFollowingBack(normalizedFollowers, normalizedFollowing);
                const youDontFollow = calculateYouDontFollow(normalizedFollowers, normalizedFollowing);
                
                // Update stats safely
                updateElementText('followersCount', normalizedFollowers.length);
                updateElementText('followingCount', normalizedFollowing.length);
                updateElementText('blockedCount', normalizedBlocked.length);
                updateElementText('restrictedCount', normalizedRestricted.length);
                updateElementText('notFollowingBackCount', notFollowingBack.length);
                updateElementText('youDontFollowCount', youDontFollow.length);
                
                // Update section titles to be clearer
                document.querySelector('#notFollowingBackSection h2').textContent = 'People Who Don\'t Follow You Back';
                document.querySelector('#youDontFollowSection h2').textContent = 'People Who Follow You But You Don\'t Follow Back';
                
                // Render lists
                renderUserList(normalizedFollowers, 'followersList', 'Followers');
                renderUserList(normalizedFollowing, 'followingList', 'Following');
                renderUserList(normalizedBlocked, 'blockedList', 'Blocked Users');
                renderUserList(normalizedRestricted, 'restrictedList', 'Restricted Users');
                renderUserList(notFollowingBack, 'notFollowingBackList', 'Not Following Back');
                renderUserList(youDontFollow, 'youDontFollowList', 'You Don\'t Follow');
                
                // Show results
                document.getElementById('mainContent').style.display = 'block';
                document.getElementById('uploadSection').style.display = 'none';
                
            } catch (error) {
                console.error('Error processing data:', error);
                showError(
                    'Error Processing Data',
                    'There was a problem processing your Instagram data:',
                    [
                        'Make sure you selected JSON format when requesting data',
                        'Check if the ZIP file contains followers and following data',
                        'Try downloading your data again from Instagram'
                    ]
                );
            }
        }

        // Helper function to normalize user data from different sources
        function normalizeUserData(users) {
            return users.map(user => {
                try {
                    // Based on the actual JSON structure we observed
                    if (user.string_list_data && user.string_list_data.length > 0) {
                        return {
                            username: user.string_list_data[0].value || user.title || 'Unknown',
                            href: user.string_list_data[0].href || '#',
                            timestamp: user.string_list_data[0].timestamp || null
                        };
                    } else if (user.title) {
                        return {
                            username: user.title,
                            href: '#',
                            timestamp: null
                        };
                    } else {
                        console.warn('Unknown user format:', user);
                        return {
                            username: 'Unknown User',
                            href: '#',
                            timestamp: null
                        };
                    }
                } catch (e) {
                    console.error('Error normalizing user:', user, e);
                    return {
                        username: 'Error',
                        href: '#',
                        timestamp: null
                    };
                }
            });
        }

        // Helper function to update element text
        function updateElementText(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value.toLocaleString();
            } else {
                console.warn(`Element with ID ${elementId} not found`);
            }
        }

        // Helper function to update element label
        function updateElementLabel(elementId, text) {
            const element = document.querySelector(`[for="${elementId}"], .${elementId}, #${elementId}`);
            if (element) {
                element.textContent = text;
            }
        }

        // Calculate relationships between followers and following
        function calculateNotFollowingBack(followers, following) {
            try {
                const followerUsernames = new Set(followers.map(f => f.username));
                return following.filter(f => !followerUsernames.has(f.username));
            } catch (error) {
                console.error('Error calculating not following back:', error);
                return [];
            }
        }

        function calculateYouDontFollow(followers, following) {
            try {
                const followingUsernames = new Set(following.map(f => f.username));
                return followers.filter(f => !followingUsernames.has(f.username));
            } catch (error) {
                console.error('Error calculating you don\'t follow:', error);
                return [];
            }
        }

        // Network visualization code
        /* Network visualization code - for future release
        function showNetworkView() {
            // Create a new div for the network view
            const networkContainer = document.createElement('div');
            networkContainer.id = 'networkViewContainer';
            networkContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                z-index: 9999;
                display: none;
            `;

            // Add close button
            const closeButton = document.createElement('button');
            closeButton.innerHTML = '×';
            closeButton.className = 'network-close-btn';
            closeButton.onclick = hideNetworkView;

            networkContainer.innerHTML = `
                <div class="network-content">
                    <div class="network-legend">
                        <h3>Network Legend</h3>
                        <div class="legend-item">
                            <span class="color-dot" style="background: #E1306C"></span>
                            <span>You (Center)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-dot" style="background: #405DE6"></span>
                            <span>Mutual Connections</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-dot" style="background: #5851DB"></span>
                            <span>You Follow Them</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-dot" style="background: #833AB4"></span>
                            <span>They Follow You</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-dot" style="background: #C13584"></span>
                            <span>Blocked Users</span>
                        </div>
                    </div>
                    <div id="networkGraph"></div>
                </div>
            `;

            // Add styles for the network view
            const styles = `
                <style>
                    #networkViewContainer {
                        opacity: 0;
                        transition: opacity 0.3s ease;
                    }
                    #networkViewContainer.visible {
                        opacity: 1;
                    }
                    .network-content {
                        width: 100%;
                        height: 100%;
                        position: relative;
                    }
                    .network-close-btn {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: none;
                        border: none;
                        color: white;
                        font-size: 32px;
                        cursor: pointer;
                        z-index: 10000;
                        width: 40px;
                        height: 40px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        background: rgba(255,255,255,0.1);
                        transition: all 0.3s ease;
                    }
                    .network-close-btn:hover {
                        background: rgba(255,255,255,0.2);
                        transform: scale(1.1);
                    }
                    .network-legend {
                        position: fixed;
                        top: 20px;
                        left: 20px;
                        background: rgba(38, 38, 38, 0.95);
                        padding: 20px;
                        border-radius: 12px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                        z-index: 10000;
                    }
                    .network-legend h3 {
                        color: white;
                        margin: 0 0 15px 0;
                    }
                    .legend-item {
                        display: flex;
                        align-items: center;
                        margin: 10px 0;
                        color: white;
                    }
                    .color-dot {
                        width: 12px;
                        height: 12px;
                        border-radius: 50%;
                        margin-right: 10px;
                    }
                    #networkGraph {
                        width: 100%;
                        height: 100%;
                    }
                    .node-label {
                        fill: white;
                        font-size: 12px;
                        text-anchor: middle;
                    }
                </style>
            `;

            // Add the network container and styles to the document
            document.body.insertAdjacentHTML('beforeend', styles);
            document.body.appendChild(networkContainer);
            networkContainer.appendChild(closeButton);

            // Show the network view with animation
            requestAnimationFrame(() => {
                networkContainer.style.display = 'block';
                requestAnimationFrame(() => {
                    networkContainer.classList.add('visible');
                });
            });

            // Initialize the network visualization
            initializeNetwork(window.instagramData);
        }

        function hideNetworkView() {
            const container = document.getElementById('networkViewContainer');
            if (container) {
                container.classList.remove('visible');
                setTimeout(() => {
                    container.style.display = 'none';
                    container.remove();
                }, 300);
            }
        }

        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function initializeNetwork(data) {
            try {
                // Clear any existing visualization
                const networkGraph = document.getElementById('networkGraph');
                networkGraph.innerHTML = '';
                
                // Get container dimensions
                const width = networkGraph.clientWidth;
                const height = networkGraph.clientHeight || window.innerHeight;
                
                // Create SVG
                const svg = d3.select('#networkGraph')
                    .append('svg')
                    .attr('width', '100%')
                    .attr('height', '100%')
                    .attr('viewBox', [0, 0, width, height]);
                
                // Extract and normalize data
                const normalizedFollowers = normalizeUserData(data.followers || []);
                const normalizedFollowing = normalizeUserData(data.following?.relationships_following || []);
                
                // Create nodes and links
                const nodes = [];
                const nodeMap = new Map();
                const links = [];
                
                // Add center node (you)
                nodes.push({
                    id: 'you',
                    name: 'You',
                    group: 'center'
                });
                nodeMap.set('you', 0);
                
                // Add follower and following nodes
                normalizedFollowers.forEach(user => {
                    if (!nodeMap.has(user.username)) {
                        nodes.push({
                            id: user.username,
                            name: user.username,
                            group: 'follower'
                        });
                        nodeMap.set(user.username, nodes.length - 1);
                        links.push({
                            source: user.username,
                            target: 'you',
                            type: 'follower'
                        });
                    }
                });
                
                normalizedFollowing.forEach(user => {
                    if (!nodeMap.has(user.username)) {
                        nodes.push({
                            id: user.username,
                            name: user.username,
                            group: 'following'
                        });
                        nodeMap.set(user.username, nodes.length - 1);
                        links.push({
                            source: 'you',
                            target: user.username,
                            type: 'following'
                        });
                    } else {
                        // Update group for mutual connections
                        const index = nodeMap.get(user.username);
                        nodes[index].group = 'mutual';
                    }
                });
                
                // Create simulation
                const simulation = d3.forceSimulation(nodes)
                    .force('link', d3.forceLink(links).id(d => d.id).distance(100))
                    .force('charge', d3.forceManyBody().strength(-300))
                    .force('center', d3.forceCenter(width / 2, height / 2));
                
                // Create the links
                const link = svg.append('g')
                    .attr('class', 'links')
                    .selectAll('line')
                    .data(links)
                    .join('line')
                    .attr('stroke', '#999')
                    .attr('stroke-opacity', 0.6)
                    .attr('stroke-width', 1);
                
                // Create the nodes
                const node = svg.append('g')
                    .attr('class', 'nodes')
                    .selectAll('g')
                    .data(nodes)
                    .join('g')
                    .call(d3.drag()
                        .on('start', dragstarted)
                        .on('drag', dragged)
                        .on('end', dragended));
                
                // Add circles for nodes
                node.append('circle')
                    .attr('r', d => d.group === 'center' ? 20 : 15)
                    .attr('fill', d => {
                        switch(d.group) {
                            case 'center': return '#E1306C';
                            case 'mutual': return '#405DE6';
                            case 'follower': return '#833AB4';
                            case 'following': return '#5851DB';
                            default: return '#999';
                        }
                    })
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 1.5);
                
                // Add labels
                node.append('text')
                    .attr('class', 'node-label')
                    .attr('dy', 25)
                    .attr('text-anchor', 'middle')
                    .text(d => d.name)
                    .style('font-size', '10px')
                    .style('fill', '#ffffff');
                
                // Update positions on tick
                simulation.on('tick', () => {
                    link
                        .attr('x1', d => d.source.x)
                        .attr('y1', d => d.source.y)
                        .attr('x2', d => d.target.x)
                        .attr('y2', d => d.target.y);
                    
                    node
                        .attr('transform', d => `translate(${d.x},${d.y})`);
                });
                
                // Drag functions
                function dragstarted(event, d) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                }
                
                function dragged(event, d) {
                    d.fx = event.x;
                    d.fy = event.y;
                }
                
                function dragended(event, d) {
                    if (!event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                }
                
                // Update legend counts
                document.getElementById('mutualCount').textContent = nodes.filter(n => n.group === 'mutual').length;
                document.getElementById('followerCount').textContent = nodes.filter(n => n.group === 'follower').length;
                document.getElementById('followingCount').textContent = nodes.filter(n => n.group === 'following').length;
                
            } catch (error) {
                console.error('Error creating network visualization:', error);
                const networkGraph = document.getElementById('networkGraph');
                networkGraph.innerHTML = '<div style="color: white; text-align: center; padding: 20px;">Error creating network visualization</div>';
            }
        }
        */

        function sortUsers(containerId, sortType, buttonElement) {
            const container = document.getElementById(containerId);
            const items = Array.from(container.children);
            
            // Update button states
            buttonElement.parentElement.querySelectorAll('.sort-button').forEach(btn => {
                btn.classList.remove('active');
            });
            buttonElement.classList.add('active');
            
            items.sort((a, b) => {
                const aData = {
                    name: a.querySelector('.user-link')?.textContent.trim() || '',
                    date: parseInt(a.querySelector('.timestamp')?.dataset?.timestamp || '0')
                };
                const bData = {
                    name: b.querySelector('.user-link')?.textContent.trim() || '',
                    date: parseInt(b.querySelector('.timestamp')?.dataset?.timestamp || '0')
                };
                
                switch(sortType) {
                    case 'newest': return bData.date - aData.date;
                    case 'oldest': return aData.date - bData.date;
                    case 'name': return aData.name.localeCompare(bData.name);
                    default: return 0;
                }
            });
            
            container.innerHTML = '';
            items.forEach(item => container.appendChild(item));
        }

        function toggleSection(button) {
            const section = button.closest('.section');
            const content = section.querySelector('.section-content');
            const isCollapsed = !content.classList.contains('collapsed');
            
            if (isCollapsed) {
                content.classList.add('collapsed');
                button.classList.add('collapsed');
                button.setAttribute('aria-expanded', 'false');
            } else {
                content.classList.remove('collapsed');
                button.classList.remove('collapsed');
                button.setAttribute('aria-expanded', 'true');
            }
        }

        // Render user lists with proper error handling
        function renderUserList(users, containerId, listName) {
            const container = document.getElementById(containerId);
            if (!container) {
                log.error(`Container ${containerId} not found`);
                return;
            }

            container.innerHTML = '';
            
            if (!users || users.length === 0) {
                container.innerHTML = `<div class="empty-list">No ${listName} found</div>`;
                return;
            }

            users.forEach(user => {
                try {
                    const listItem = document.createElement('div');
                    listItem.className = 'user-item';
                    
                    const timestamp = user.timestamp ? new Date(user.timestamp * 1000) : null;
                    const timeAgo = timestamp ? formatTimeAgo(timestamp) : '';
                    
                    // Get username for avatar
                    const username = user.username || 'Unknown User';
                    const firstLetter = username.charAt(0).toUpperCase();
                    
                    listItem.innerHTML = `
                        <a href="${user.href}" target="_blank" class="user-link">
                            <div class="user-avatar-placeholder" id="avatar-${username}">
                                ${firstLetter}
                            </div>
                            <span class="user-name">${username}</span>
                        </a>
                        ${timestamp ? `<span class="timestamp" data-timestamp="${user.timestamp}">${timeAgo}</span>` : ''}
                    `;
                    
                    container.appendChild(listItem);
                    
                    // Try to load the user's avatar
                    if (username !== 'Unknown User') {
                        fetchInstagramAvatar(username, `avatar-${username}`);
                    }
                } catch (error) {
                    log.error('Error rendering user:', user, error);
                }
            });
        }

        // Format timestamp to human-readable format
        function formatTimeAgo(date) {
            try {
                const now = new Date();
                const seconds = Math.floor((now - date) / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);
                const months = Math.floor(days / 30);
                const years = Math.floor(months / 12);

                if (years > 0) return `${years}y ago`;
                if (months > 0) return `${months}mo ago`;
                if (days > 0) return `${days}d ago`;
                if (hours > 0) return `${hours}h ago`;
                if (minutes > 0) return `${minutes}m ago`;
                return 'just now';
            } catch (error) {
                console.error('Error formatting time:', error);
                return '';
            }
        }

        // Add function to fetch Instagram avatars
        async function fetchInstagramAvatar(username, elementId) {
            try {
                const response = await fetch(`https://www.instagram.com/${username}/?__a=1`);
                if (response.ok) {
                    const data = await response.json();
                    const avatarUrl = data.graphql?.user?.profile_pic_url;
                    if (avatarUrl) {
                        const element = document.getElementById(elementId);
                        if (element) {
                            const img = document.createElement('img');
                            img.src = avatarUrl;
                            img.className = 'user-avatar';
                            img.alt = `${username}'s avatar`;
                            element.parentNode.replaceChild(img, element);
                        }
                    }
                }
            } catch (error) {
                // Silently fail - keep the placeholder if avatar can't be loaded
                log.error('Error fetching avatar for', username, error);
            }
        }
    </script>
</body>
</html> 