<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Privately analyze your Instagram connections data - everything stays in your browser">
    <title>Instagram Data Viewer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>🔒</text></svg>">
    <!-- Include JSZip library for handling zip files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- Include D3.js for network visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background: #fafafa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #262626;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            overflow-x: auto;
            padding: 5px;
        }

        @media (min-width: 640px) {
            .stats {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .stats {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: unset;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #262626;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #8e8e8e;
            font-size: 14px;
            font-weight: 500;
        }

        .stat-trend {
            font-size: 12px;
            margin-top: 8px;
            color: #00aa00;
        }

        .stat-trend.negative {
            color: #ff0000;
        }

        .section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .section {
                padding: 20px;
            }
        }

        .section-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #dbdbdb;
            padding-bottom: 10px;
            gap: 10px;
        }

        @media (min-width: 768px) {
            .section-header {
                flex-direction: row;
                justify-content: space-between;
            }
        }

        .section-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-header h2 {
            margin-top: 0;
            color: #262626;
            margin-bottom: 0;
        }

        .section-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            color: #8e8e8e;
            font-size: 13px;
        }

        .section-info i {
            margin-right: 5px;
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            align-items: center;
            padding: 12px 10px;
            border-bottom: 1px solid #efefef;
            transition: all 0.2s ease;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .user-link {
            color: #262626;
            text-decoration: none;
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-link i {
            font-size: 12px;
            color: #8e8e8e;
        }

        .timestamp {
            color: #8e8e8e;
            font-size: 12px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        @media (max-width: 480px) {
            .user-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .timestamp {
                width: 100%;
                justify-content: flex-start;
                padding-left: 24px;
            }
        }

        .search {
            width: 100%;
            padding: 10px;
            border: 1px solid #dbdbdb;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .upload-section {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #dbdbdb;
            border-radius: 8px;
            background: white;
        }

        @media (min-width: 768px) {
            .upload-section {
                margin: 40px 0;
                padding: 40px;
            }
        }

        .upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .upload-icon {
            font-size: 48px;
            color: #8e8e8e;
        }

        .upload-title {
            font-size: 20px;
            font-weight: 600;
            color: #262626;
        }

        .upload-button {
            background: #0095f6;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .upload-button:hover {
            background: #0081d6;
        }

        .upload-info {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
            padding: 0 10px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #8e8e8e;
            font-size: 13px;
            text-align: left;
        }

        .info-item i {
            font-size: 18px;
        }

        .upload-section.drag-over {
            background: #f8f8f8;
            border-color: #0095f6;
        }

        .upload-text {
            color: #8e8e8e;
            margin: 10px 0;
        }

        #mainContent {
            display: none;
        }

        .documentation {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .documentation code {
            background: #f6f6f6;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .privacy-notice {
            color: #8e8e8e;
            font-size: 14px;
            text-align: center;
            margin: 20px 0;
        }

        .privacy-link {
            color: #00376b;
            text-decoration: none;
        }

        .privacy-link:hover {
            text-decoration: underline;
        }

        .support-button {
            display: inline-flex;
            align-items: center;
            background: #FFDD00;
            color: #000000;
            padding: 8px 16px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .support-button:hover {
            background: #FFE838;
            transform: translateY(-2px);
        }

        .support-button img {
            height: 20px;
            margin-right: 8px;
        }

        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            border-top: 1px solid #dbdbdb;
        }

        /* Privacy page specific styles */
        .privacy-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.8;
        }

        .privacy-content h2 {
            color: #262626;
            margin-top: 30px;
        }

        .privacy-content p {
            margin-bottom: 20px;
        }

        /* Platform tabs styling */
        .platform-tabs {
            display: flex;
            gap: 2px;
            margin-bottom: 20px;
            background: #f0f0f0;
            padding: 4px;
            border-radius: 8px;
        }

        .platform-tab {
            padding: 8px 16px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 500;
            color: #8e8e8e;
            flex: 1;
            transition: all 0.3s ease;
        }

        .platform-tab.active {
            background: white;
            color: #262626;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .platform-tab:hover:not(.active) {
            background: rgba(255,255,255,0.5);
        }

        .platform-content {
            display: none;
            margin-bottom: 20px;
        }

        .platform-content.active {
            display: block;
        }

        .reference-link {
            display: block;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dbdbdb;
            color: #8e8e8e;
            font-size: 14px;
            text-align: center;
        }

        .reference-link a {
            color: #00376b;
            text-decoration: none;
        }

        .reference-link a:hover {
            text-decoration: underline;
        }

        /* Network visualization styles */
        .network-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            overflow: hidden;
        }

        .network-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            max-width: 300px;
            z-index: 1001;
        }

        .network-info {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .network-info h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        #nodeDetails {
            font-size: 14px;
            color: #666;
        }

        .control-group {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .control-group h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .control-item {
            margin-bottom: 10px;
        }

        .control-item button {
            margin-right: 8px;
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }

        .control-item button:hover {
            background: #f5f5f5;
        }

        .network-legend {
            font-size: 14px;
        }

        .network-legend h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .legend-count {
            margin-left: auto;
            color: #666;
            font-size: 12px;
        }

        .node-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            pointer-events: none;
            z-index: 1002;
            max-width: 200px;
        }

        @media (max-width: 1200px) {
            .stats {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .sort-controls {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            width: 100%;
            padding-bottom: 5px;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .sort-controls {
                width: auto;
                justify-content: flex-end;
                padding-bottom: 0;
            }
        }

        .sort-button {
            padding: 8px 12px;
            border: 1px solid #dbdbdb;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        .sort-button:hover {
            background: #f8f9fa;
        }

        .sort-button.active {
            background: #0095f6;
            color: white;
            border-color: #0095f6;
        }

        .date-info {
            font-size: 12px;
            color: #8e8e8e;
            margin-top: 5px;
        }

        .toggle-section {
            background: none;
            border: none;
            cursor: pointer;
            color: #8e8e8e;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .toggle-section:hover {
            background: #f8f9fa;
            color: #262626;
        }

        .toggle-section i {
            transition: transform 0.3s ease;
        }

        .toggle-section.collapsed i {
            transform: rotate(-90deg);
        }

        .section-content {
            transition: all 0.3s ease;
        }

        .section-content.collapsed {
            display: none;
        }

        .upload-section.error {
            border-color: #ffcdd2;
            background: #fff5f5;
        }

        .upload-section.error .upload-title {
            color: #e44;
        }

        .upload-section.error .upload-button {
            background: #e44;
            color: white;
        }

        .upload-section.error .upload-button:hover {
            background: #f55;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Instagram Data Viewer</h1>
        </div>

        <div class="documentation">
            <h2>How to Get Your Instagram Followers & Following Data</h2>
            <p style="color: #8e8e8e; margin-bottom: 20px;">
                You only need your followers and following data. Choose your Instagram setup below:
            </p>

            <div class="platform-tabs">
                <button class="platform-tab active" onclick="showPlatform('meta')">Meta Accounts Center</button>
                <button class="platform-tab" onclick="showPlatform('instagram')">Instagram Settings</button>
                <button class="platform-tab" onclick="showPlatform('lite')">Instagram Lite</button>
            </div>

            <div id="meta-instructions" class="platform-content active">
                <p><strong>For accounts connected to Meta Accounts Center:</strong></p>
                <ol>
                    <li><strong>Go to Meta Accounts Center</strong>
                        <ul>
                            <li>Open Instagram Settings</li>
                            <li>Tap/Click "Accounts Center"</li>
                        </ul>
                    </li>
                    <li><strong>Navigate to Download Options</strong>
                        <ul>
                            <li>Select "Your information and permissions"</li>
                            <li>Click "Download your information"</li>
                            <li>Click "Download or transfer information"</li>
                        </ul>
                    </li>
                    <li><strong>Select Data to Download</strong>
                        <ul>
                            <li>Choose "Some of your information" (not "All your information")</li>
                            <li>Under "Connections" section, check only "Followers and following"</li>
                            <li>Uncheck all other options (we only need followers/following data)</li>
                        </ul>
                    </li>
                    <li><strong>Configure Download Settings</strong>
                        <ul>
                            <li>Click "Download to device"</li>
                            <li>Select your preferred date range</li>
                            <li>Change format to "JSON" (important!)</li>
                            <li>Click "Submit request"</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div id="instagram-instructions" class="platform-content">
                <p><strong>For regular Instagram accounts (not connected to Meta):</strong></p>
                <ol>
                    <li>Go to Instagram Settings (gear icon ⚙️ or three lines ☰)</li>
                    <li>Select "Privacy and Security"</li>
                    <li>Scroll to "Data Download" section</li>
                    <li>Click "Request Download"</li>
                    <li>Enter your email address</li>
                    <li>Select "JSON" as the format (required)</li>
                    <li>Enter your Instagram password</li>
                    <li>Click "Next" and then "Done"</li>
                </ol>
            </div>

            <div id="lite-instructions" class="platform-content">
                <p><strong>For Instagram Lite users:</strong></p>
                <ol>
                    <li>Tap the profile icon (👤)</li>
                    <li>Tap the menu (☰) in the top right</li>
                    <li>Tap "Settings"</li>
                    <li>Tap "Account"</li>
                    <li>Tap "Download your information"</li>
                    <li>Enter your email</li>
                    <li>Select "JSON" format (required)</li>
                    <li>Tap "Request download"</li>
                </ol>
            </div>
        </div>

        <div class="privacy-notice">
            🔒 Your privacy matters! We process all data locally in your browser - nothing is uploaded to any server. 
            <a href="privacy.html" class="privacy-link">Learn more about our privacy policy</a>
        </div>

        <div class="upload-section" id="uploadSection">
            <div class="upload-container">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-title">Upload Your Instagram Data</div>
                <input type="file" id="zipUpload" accept=".zip" style="display: none">
                <button class="upload-button" onclick="document.getElementById('zipUpload').click()">
                    <i class="fas fa-file-archive"></i> Select ZIP File
                </button>
                <p class="upload-text">or drag and drop your ZIP file here</p>
                
                <div class="upload-info">
                    <div class="info-item">
                        <i class="fas fa-lock"></i>
                        <span>100% Private</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-desktop"></i>
                        <span>Processed Locally</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-bolt"></i>
                        <span>Instant Results</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="mainContent">
            <div class="stats">
                <div class="stat-card" onclick="scrollToSection('followersList')">
                    <div class="stat-number" id="followersCount">0</div>
                    <div class="stat-label">Followers</div>
                    <div class="stat-trend" id="followersGrowth"></div>
                </div>
                <div class="stat-card" onclick="scrollToSection('followingList')">
                    <div class="stat-number" id="followingCount">0</div>
                    <div class="stat-label">Following</div>
                    <div class="stat-trend" id="followingRatio"></div>
                </div>
                <div class="stat-card" onclick="scrollToSection('blockedList')">
                    <div class="stat-number" id="blockedCount">0</div>
                    <div class="stat-label">Blocked</div>
                    <div class="stat-trend">For your peace of mind</div>
                </div>
                <div class="stat-card" onclick="scrollToSection('notFollowingList')">
                    <div class="stat-number" id="notFollowingBackCount">0</div>
                    <div class="stat-label">Ghost Followers</div>
                    <div class="stat-trend negative">Not following you back</div>
                </div>
                <div class="stat-card" onclick="scrollToSection('notFollowedList')">
                    <div class="stat-number" id="notFollowedBackCount">0</div>
                    <div class="stat-label">Potential Connections</div>
                    <div class="stat-trend">Followers you could follow back</div>
                </div>
                <div class="stat-card" onclick="showNetworkView()">
                    <div class="stat-number">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <div class="stat-label">Interactive Network</div>
                    <div class="stat-trend">Visualize connections</div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" onclick="toggleSection(this)">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>Followers</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('followersList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('followersList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('followersList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> When they followed you</span>
                    </div>
                    <input type="text" class="search" id="followersSearch" placeholder="Search followers...">
                    <div class="user-list" id="followersList"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" onclick="toggleSection(this)">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>Following</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('followingList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('followingList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('followingList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> When you followed them</span>
                    </div>
                    <input type="text" class="search" id="followingSearch" placeholder="Search following...">
                    <div class="user-list" id="followingList"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" onclick="toggleSection(this)">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>Blocked Users</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('blockedList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('blockedList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('blockedList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> When you blocked these users</span>
                    </div>
                    <input type="text" class="search" id="blockedSearch" placeholder="Search blocked users...">
                    <div class="user-list" id="blockedList"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" onclick="toggleSection(this)">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>Restricted Users</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('restrictedList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('restrictedList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('restrictedList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> When you restricted these users</span>
                    </div>
                    <input type="text" class="search" id="restrictedSearch" placeholder="Search restricted users...">
                    <div class="user-list" id="restrictedList"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" onclick="toggleSection(this)">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>Users Not Following You Back</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('notFollowingList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('notFollowingList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('notFollowingList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> People you follow who don't follow you back</span>
                    </div>
                    <input type="text" class="search" id="notFollowingSearch" placeholder="Search users...">
                    <div class="user-list" id="notFollowingList"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-header-left">
                        <button class="toggle-section" onclick="toggleSection(this)">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <h2>Your Non-Followed Followers</h2>
                    </div>
                    <div class="sort-controls">
                        <button class="sort-button active" onclick="sortUsers('notFollowedList', 'newest', this)">
                            <i class="fas fa-clock"></i> Newest
                        </button>
                        <button class="sort-button" onclick="sortUsers('notFollowedList', 'oldest', this)">
                            <i class="fas fa-history"></i> Oldest
                        </button>
                        <button class="sort-button" onclick="sortUsers('notFollowedList', 'name', this)">
                            <i class="fas fa-sort-alpha-down"></i> Name
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <div class="section-info">
                        <span><i class="fas fa-info-circle"></i> People who follow you but you don't follow back</span>
                    </div>
                    <input type="text" class="search" id="notFollowedSearch" placeholder="Search users...">
                    <div class="user-list" id="notFollowedList"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Find this tool useful?</p>
            <a href="https://www.buymeacoffee.com/jramasani" target="_blank" class="support-button">
                <img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="Buy me a coffee">
                Buy me a coffee
            </a>
        </div>
    </div>

    <div id="networkView" class="network-view">
        <button class="close-network" onclick="hideNetworkView()">×</button>
        <div class="network-controls">
            <div class="network-info">
                <h3>Selected Node: <span id="selectedNode">None</span></h3>
                <div id="nodeDetails"></div>
            </div>
            <div class="control-group">
                <h4>Controls</h4>
                <div class="control-item">
                    <button id="resetLayout" onclick="resetNetworkLayout()">Reset Layout</button>
                    <button id="centerGraph" onclick="centerNetworkGraph()">Center Graph</button>
                </div>
            </div>
            <div class="network-legend">
                <h4>Network Legend</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background: #1da1f2"></div>
                    <span>You (Center)</span>
                    <span class="legend-count" id="centerCount">1</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4caf50"></div>
                    <span>Mutual Connections</span>
                    <span class="legend-count" id="mutualCount">0</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff9800"></div>
                    <span>You Follow Them</span>
                    <span class="legend-count" id="followingCount">0</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e91e63"></div>
                    <span>They Follow You</span>
                    <span class="legend-count" id="followerCount">0</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f44336"></div>
                    <span>Blocked Users</span>
                    <span class="legend-count" id="blockedCount">0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Platform tabs functionality
        function showPlatform(platform) {
            // Update tabs
            document.querySelectorAll('.platform-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.platform-tab[onclick="showPlatform('${platform}')"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.platform-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${platform}-instructions`).classList.add('active');
        }

        // Handle file upload via drag and drop
        const uploadSection = document.getElementById('uploadSection');
        const mainContent = document.getElementById('mainContent');

        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('drag-over');
        });

        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('drag-over');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file.name.endsWith('.zip')) {
                processZipFile(file);
            } else {
                alert('Please upload a ZIP file');
            }
        });

        document.getElementById('zipUpload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                processZipFile(file);
            }
        });

        async function processZipFile(file) {
            try {
                console.log('Processing ZIP file:', file.name);
                const zip = await JSZip.loadAsync(file);
                
                // Show loading state
                document.querySelector('.upload-title').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                document.querySelector('.upload-text').textContent = 'Please wait while we analyze your data locally';

                // Find files in the nested structure
                const findFile = (filename) => {
                    const possiblePaths = [
                        filename,
                        `connections/followers_and_following/${filename}`,
                        `followers_and_following/${filename}`,
                        `media/${filename}`,
                        `connections/${filename}`
                    ];
                    
                    for (const path of possiblePaths) {
                        const file = zip.file(path);
                        if (file) {
                            console.log(`Found ${filename} at ${path}`);
                            return file;
                        }
                    }
                    
                    console.warn(`File not found: ${filename}`);
                    return null;
                };

                // Try to find each required file
                const followers = findFile("followers_1.json");
                const following = findFile("following.json");

                if (!followers || !following) {
                    showError(
                        "We couldn't find your followers and following data",
                        "Please make sure:",
                        [
                            "You downloaded your Instagram data in JSON format",
                            "You included 'Followers and following' in your data request",
                            "You're using the ZIP file from your most recent data download"
                        ]
                    );
                    return;
                }

                // Parse the files
                const filePromises = {
                    followers: followers.async("text").then(JSON.parse),
                    following: following.async("text").then(JSON.parse),
                    blocked: findFile("blocked_profiles.json")?.async("text").then(JSON.parse).catch(() => null),
                    restricted: findFile("restricted_profiles.json")?.async("text").then(JSON.parse).catch(() => null)
                };

                const data = {};
                for (const [key, promise] of Object.entries(filePromises)) {
                    try {
                        data[key] = await promise;
                    } catch (err) {
                        console.warn(`Failed to load ${key} data:`, err);
                        data[key] = null;
                        if (key === 'followers' || key === 'following') {
                            showError(
                                "There seems to be an issue with your data file",
                                "This could be because:",
                                [
                                    "The file might be corrupted",
                                    "The data format might have changed",
                                    "You might need to request a new data download"
                                ]
                            );
                            return;
                        }
                    }
                }

                // Process the data
                processInstagramData(data);
                
                // Show the main content and hide upload section
                document.getElementById('uploadSection').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';

            } catch (error) {
                console.error('Error processing ZIP file:', error);
                
                if (error.message?.includes('invalid zip')) {
                    showError(
                        "This doesn't look like a valid ZIP file",
                        "Please make sure:",
                        [
                            "You're using the ZIP file from Instagram",
                            "The file downloaded completely",
                            "The file hasn't been modified"
                        ]
                    );
                } else {
                    showError(
                        "Something went wrong while processing your data",
                        "You could try:",
                        [
                            "Downloading your data again from Instagram",
                            "Making sure you selected JSON format",
                            "Using a different browser"
                        ]
                    );
                }
            }
        }

        // Helper function to show user-friendly errors
        function showError(title, subtitle, bulletPoints) {
            const uploadSection = document.getElementById('uploadSection');
            const uploadTitle = document.querySelector('.upload-title');
            const uploadText = document.querySelector('.upload-text');
            
            uploadTitle.innerHTML = `<i class="fas fa-exclamation-circle" style="color: #e44"></i> ${title}`;
            
            let errorHtml = `
                <div style="color: #666; margin: 15px 0;">
                    ${subtitle}
                    <ul style="text-align: left; margin: 10px 0; padding-left: 20px;">
                        ${bulletPoints.map(point => `<li>${point}</li>`).join('')}
                    </ul>
                </div>
                <button class="upload-button" onclick="document.getElementById('zipUpload').click()">
                    <i class="fas fa-redo"></i> Try Another File
                </button>
            `;
            
            uploadText.innerHTML = errorHtml;
            uploadSection.classList.add('error');
        }

        function processInstagramData(data) {
            console.log('Processing data:', data);
            window.instagramData = data;

            const followers = data.followers;
            const following = data.following.relationships_following;
            
            // Fix blocked users data structure
            const blocked = data.blocked?.relationships_blocked_v2 || 
                           data.blocked?.relationships_blocked_users || 
                           data.blocked?.blocked_users || 
                           [];
            
            // Fix restricted users data structure
            const restricted = data.restricted?.relationships_restricted_v2 || 
                              data.restricted?.restricted_users || 
                              [];

            // Normalize blocked/restricted data structure
            const normalizeUserData = (user) => {
                if (user.string_list_data) return user.string_list_data[0];
                return {
                    href: `https://instagram.com/${user.title || user.username}`,
                    value: user.title || user.username,
                    timestamp: user.timestamp || Date.now()/1000
                };
            };

            const normalizedBlocked = blocked.map(normalizeUserData);
            const normalizedRestricted = restricted.map(normalizeUserData);

            console.log('Parsed data:', {
                followersCount: followers?.length,
                followingCount: following?.length,
                blockedCount: normalizedBlocked.length,
                restrictedCount: normalizedRestricted.length
            });

            // Update stats
            const stats = {
                followers: followers.length,
                following: following.length,
                blocked: normalizedBlocked.length,
                restricted: normalizedRestricted.length
            };

            updateStats(stats);

            // Render lists with normalized data
            renderUserList(followers.map(user => user.string_list_data[0]), 'followersList');
            renderUserList(following.map(user => user.string_list_data[0]), 'followingList');
            renderUserList(normalizedBlocked, 'blockedList');
            renderUserList(normalizedRestricted, 'restrictedList');
            
            // ... rest of the function
        }

        // Function to format timestamp to readable date
        function formatDate(timestamp) {
            return new Date(timestamp * 1000).toLocaleDateString();
        }

        // Function to create user item HTML
        function createUserItem(user) {
            return `
                <div class="user-item">
                    <a href="${user.href}" target="_blank" class="user-link">
                        ${user.value || user.title}
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    <span class="timestamp" data-timestamp="${user.timestamp}">
                        <i class="far fa-clock"></i>
                        ${formatRelativeDate(user.timestamp)}
                    </span>
                </div>
            `;
        }

        function formatFullDate(timestamp) {
            return new Date(timestamp * 1000).toLocaleString();
        }

        function formatRelativeDate(timestamp) {
            const date = new Date(timestamp * 1000);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 30) return `${diffDays} days ago`;
            if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
            return `${Math.floor(diffDays / 365)} years ago`;
        }

        // Function to filter users based on search
        function filterUsers(users, searchTerm) {
            return users.filter(user => 
                (user.value || user.title).toLowerCase().includes(searchTerm.toLowerCase())
            );
        }

        // Function to render user list
        function renderUserList(users, containerId) {
            console.log(`Rendering user list for ${containerId}`, users);
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`Container not found: ${containerId}`);
                return;
            }
            container.innerHTML = users.map(user => createUserItem(user)).join('');
        }

        function updateStats(stats) {
            console.log('updateStats called with:', stats);
            Object.entries(stats).forEach(([key, value]) => {
                const element = document.getElementById(`${key}Count`);
                if (!element) {
                    console.error(`Element not found: ${key}Count`);
                    return;
                }
                element.textContent = value;
            });
        }

        function renderAllLists(data) {
            renderUserList(data.followers.map(user => user.string_list_data[0]), 'followersList');
            renderUserList(data.following.map(user => user.string_list_data[0]), 'followingList');
            renderUserList(data.blocked.map(user => ({
                href: `https://instagram.com/${user.title}`,
                value: user.title,
                timestamp: user.timestamp
            })), 'blockedList');
            renderUserList(data.restricted.map(user => ({
                href: `https://instagram.com/${user.title}`,
                value: user.title,
                timestamp: user.timestamp
            })), 'restrictedList');
            renderUserList(data.notFollowingBack.map(user => user.string_list_data[0]), 'notFollowingList');
            renderUserList(data.notFollowedBack.map(user => user.string_list_data[0]), 'notFollowedList');
        }

        function setupSearchListeners(data) {
            const searchConfigs = {
                'followersSearch': data.followers,
                'followingSearch': data.following,
                'notFollowingSearch': data.notFollowingBack,
                'notFollowedSearch': data.notFollowedBack,
                'blockedSearch': data.blocked,
                'restrictedSearch': data.restricted
            };

            Object.entries(searchConfigs).forEach(([searchId, users]) => {
                const searchElement = document.getElementById(searchId);
                if (!searchElement) {
                    console.warn(`Search element not found: ${searchId}`);
                    return;
                }
                searchElement.addEventListener('input', (e) => {
                    const filtered = filterUsers(
                        users.map(user => user.string_list_data ? user.string_list_data[0] : 
                            { href: user.string_list_data[0].href, value: user.title, timestamp: user.string_list_data[0].timestamp }
                        ),
                        e.target.value
                    );
                    renderUserList(filtered, searchId.replace('Search', 'List'));
                });
            });
        }

        // Network visualization code
        function showNetworkView() {
            document.getElementById('networkView').style.display = 'block';
            // Clear any existing SVG
            d3.select('#networkView svg').remove();
            initializeNetwork(window.instagramData);
        }

        function hideNetworkView() {
            document.getElementById('networkView').style.display = 'none';
        }

        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function initializeNetwork(data) {
            if (!data) {
                console.error('No data available for network visualization');
                return;
            }

            const width = window.innerWidth;
            const height = window.innerHeight;
            const centerNode = { id: 'you', type: 'center' };
            
            // Create nodes and links from the data
            const nodes = [centerNode];
            const links = [];
            
            // Process followers and following
            const followers = new Set(data.followers.map(f => f.string_list_data[0].value));
            const following = new Set(data.following.relationships_following.map(f => f.string_list_data[0].value));
            const blocked = new Set((data.blocked?.relationships_blocked_users || []).map(b => b.title));
            
            // Add mutual connections
            followers.forEach(username => {
                const type = following.has(username) ? 'mutual' 
                    : blocked.has(username) ? 'blocked' 
                    : 'follower';
                nodes.push({ id: username, type });
                links.push({ source: username, target: 'you' });
            });
            
            // Add following-only users
            following.forEach(username => {
                if (!followers.has(username)) {
                    nodes.push({ id: username, type: 'following' });
                    links.push({ source: 'you', target: username });
                }
            });

            // Create SVG
            const svg = d3.select('#networkView')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            // Create the simulation
            const simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2));

            // Create the links
            const link = svg.append('g')
                .selectAll('line')
                .data(links)
                .join('line')
                .style('stroke', '#999')
                .style('stroke-opacity', 0.6)
                .style('stroke-width', 1);

            // Create the nodes
            const node = svg.append('g')
                .selectAll('circle')
                .data(nodes)
                .join('circle')
                .attr('r', d => d.type === 'center' ? 15 : 5)
                .style('fill', d => {
                    switch(d.type) {
                        case 'center': return '#1da1f2';
                        case 'mutual': return '#4caf50';
                        case 'following': return '#ff9800';
                        case 'follower': return '#e91e63';
                        case 'blocked': return '#f44336';
                        default: return '#999';
                    }
                })
                .call(drag(simulation));

            // Add node click handler
            node.on('click', (event, d) => {
                // Update selected node info
                document.getElementById('selectedNode').textContent = d.id;
                const details = document.getElementById('nodeDetails');
                
                if (d.id === 'you') {
                    details.innerHTML = `
                        <p>Your account (center node)</p>
                        <p>Connected to ${links.filter(l => l.source.id === 'you' || l.target.id === 'you').length} users</p>
                    `;
                } else {
                    const nodeType = d.type;
                    const connections = links.filter(l => l.source.id === d.id || l.target.id === d.id);
                    details.innerHTML = `
                        <p>Username: ${d.id}</p>
                        <p>Type: ${nodeType.charAt(0).toUpperCase() + nodeType.slice(1)}</p>
                        <p>Connections: ${connections.length}</p>
                    `;
                }
            });

            // Update legend counts
            function updateLegendCounts() {
                document.getElementById('mutualCount').textContent = nodes.filter(n => n.type === 'mutual').length;
                document.getElementById('followingCount').textContent = nodes.filter(n => n.type === 'following').length;
                document.getElementById('followerCount').textContent = nodes.filter(n => n.type === 'follower').length;
                document.getElementById('blockedCount').textContent = nodes.filter(n => n.type === 'blocked').length;
            }
            updateLegendCounts();

            // Add reset and center functions
            window.resetNetworkLayout = () => {
                simulation.alpha(1).restart();
                nodes.forEach(node => {
                    node.fx = null;
                    node.fy = null;
                });
            };

            window.centerNetworkGraph = () => {
                const centerX = width / 2;
                const centerY = height / 2;
                svg.transition()
                    .duration(750)
                    .call(zoom.transform, d3.zoomIdentity.translate(centerX, centerY));
            };

            // Enhanced tooltip
            const tooltip = d3.select('#networkView')
                .append('div')
                .attr('class', 'node-tooltip')
                .style('opacity', 0);

            node.on('mouseover', (event, d) => {
                tooltip.transition()
                    .duration(200)
                    .style('opacity', .9);
                
                const connections = links.filter(l => l.source.id === d.id || l.target.id === d.id);
                const followingCount = connections.filter(l => l.source.id === d.id).length;
                const followersCount = connections.filter(l => l.target.id === d.id).length;
                
                tooltip.html(`
                    <strong>${d.id}</strong><br/>
                    Following: ${followingCount}<br/>
                    Followers: ${followersCount}
                `)
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px');
                
                // Highlight connected nodes
                node.style('opacity', n => 
                    n.id === d.id || 
                    connections.some(l => l.source.id === n.id || l.target.id === n.id) ? 
                    1 : 0.1
                );
                link.style('opacity', l => 
                    l.source.id === d.id || l.target.id === d.id ? 
                    1 : 0.1
                );
            })
            .on('mouseout', () => {
                tooltip.transition()
                    .duration(500)
                    .style('opacity', 0);
                
                // Reset highlight
                node.style('opacity', 1);
                link.style('opacity', 0.6);
            });

            // Add zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.1, 2])
                .on('zoom', (event) => {
                    svg.selectAll('g').attr('transform', event.transform);
                });

            svg.call(zoom);

            // Update simulation on each tick
            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                node
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);
            });

            // Drag behavior
            function drag(simulation) {
                function dragstarted(event) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    event.subject.fx = event.subject.x;
                    event.subject.fy = event.subject.y;
                }

                function dragged(event) {
                    event.subject.fx = event.x;
                    event.subject.fy = event.y;
                }

                function dragended(event) {
                    if (!event.active) simulation.alphaTarget(0);
                    event.subject.fx = null;
                    event.subject.fy = null;
                }

                return d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended);
            }
        }

        function sortUsers(containerId, sortType, buttonElement) {
            const container = document.getElementById(containerId);
            const items = Array.from(container.children);
            
            // Update button states
            buttonElement.parentElement.querySelectorAll('.sort-button').forEach(btn => {
                btn.classList.remove('active');
            });
            buttonElement.classList.add('active');
            
            items.sort((a, b) => {
                const aData = {
                    name: a.querySelector('.user-link').textContent.trim(),
                    date: parseInt(a.querySelector('.timestamp').dataset.timestamp)
                };
                const bData = {
                    name: b.querySelector('.user-link').textContent.trim(),
                    date: parseInt(b.querySelector('.timestamp').dataset.timestamp)
                };
                
                switch(sortType) {
                    case 'newest': return bData.date - aData.date;
                    case 'oldest': return aData.date - bData.date;
                    case 'name': return aData.name.localeCompare(bData.name);
                }
            });
            
            container.innerHTML = '';
            items.forEach(item => container.appendChild(item));
        }

        function toggleSection(button) {
            const section = button.closest('.section');
            const content = section.querySelector('.section-content');
            button.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        }
    </script>
</body>
</html> 